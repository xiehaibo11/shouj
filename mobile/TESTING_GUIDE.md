# 测试指南 - Bug修复验证

## 已修复的Bug

### ✅ Bug #1: 删除订阅后可以再次导入

**修复内容**：
- 在 `ConfigScreenNew.kt` 中同时删除配置文件和元数据
- 现在删除订阅后，可以立即重新导入相同的URL

**测试步骤**：
1. 点击底部导航栏的"配置"标签
2. 点击"添加订阅"，输入一个订阅URL（例如你的机场订阅链接）
3. 等待导入成功，确认订阅卡片显示
4. 点击订阅卡片右上角的"⋮"菜单
5. 选择"删除"
6. 再次点击"添加订阅"，输入相同的URL
7. **预期结果**：应该成功导入，不提示"订阅已存在"

---

### ✅ Bug #2: 全局模式切换页面失效

**修复内容**：
- 在 `ProxyScreen.kt` 中添加 `LaunchedEffect` 监听 `clashMode` 变化
- 模式切换现在会正确持久化并在页面切换后保持

**测试步骤**：
1. 确保已导入至少一个订阅配置
2. 点击底部导航栏的"代理"标签
3. 点击顶部的模式切换按钮，选择"全局模式"
4. 确认顶部显示"全局模式"
5. 切换到"首页"标签
6. 再切换回"代理"标签
7. **预期结果**：顶部仍然显示"全局模式"，而不是恢复为"规则模式"

**额外验证**：
- 在首页的"代理模式"卡片也应该同步显示"全局模式"
- 重启应用后，模式设置应该保持

---

### ✅ Bug #3: 日志删除节点后仍显示

**修复内容**：
- `LogScreen.kt` 现在监听 `currentConfigPath` 变化
- 无配置时自动清空日志并显示提示信息
- 有配置时才开始显示运行日志

**测试步骤**：

#### 场景1：启动时无配置
1. 完全卸载应用后重新安装（或清除应用数据）
2. 启动应用
3. 点击底部导航栏的"日志"标签
4. **预期结果**：
   - 显示警告图标
   - 显示"请先导入配置"
   - 显示"导入订阅配置后将显示运行日志"

#### 场景2：导入配置后
1. 返回"配置"标签
2. 添加一个订阅
3. 再次进入"日志"标签
4. **预期结果**：
   - 显示初始日志："配置已加载: xxx"
   - 显示"Clash核心已初始化"
   - 开始生成运行日志（每5秒一条）

#### 场景3：删除配置后
1. 进入"配置"标签
2. 删除所有订阅
3. 再次进入"日志"标签
4. **预期结果**：
   - 日志已清空
   - 回到初始状态，显示"请先导入配置"

---

## UI优化验证

### 设计系统集成

**新增内容**：
- 创建了完整的设计系统 (`ui/theme/Dimensions.kt`)
- 遵循 Material Design 3 标准
- 支持5.8-8.3英寸所有屏幕尺寸

**测试要点**：
1. **字体大小**：
   - 所有文本应该清晰可读
   - 标题、正文、标签有明显层次
   
2. **间距一致**：
   - 卡片之间的间距均匀
   - 内容内边距合理
   
3. **触摸目标**：
   - 所有按钮和图标都应该容易点击（至少48dp）
   
4. **响应式**：
   - 旋转屏幕，布局应该自动调整
   - 在不同屏幕尺寸上测试

---

## 性能测试

### 内存和CPU
1. 打开"设置" → "开发者选项" → 显示 GPU 呈现模式分析
2. 在应用中切换不同页面
3. **预期**：没有明显卡顿，帧率稳定在60fps

### 网络请求
1. 导入订阅时观察加载时间
2. 更新订阅时观察响应速度
3. 测试节点延迟时观察UI响应

---

## 已知限制

### 日志功能
- 当前使用模拟日志（每5秒生成一条）
- 后续版本将集成真实的Clash核心日志输出
- TODO标记位置：`LogScreen.kt` 第65行

### 代理测速
- 使用简单的HTTP ping测试（`https://www.gstatic.com/generate_204`）
- 不依赖Clash API，可能与实际代理延迟有差异
- 后续可以集成Clash的内置测速功能

---

## 回归测试清单

在发布前，请确保以下功能正常：

- [ ] **首页**
  - [ ] 连接/断开按钮工作正常
  - [ ] 流量统计显示（如果VPN运行）
  - [ ] 代理模式卡片显示正确模式
  - [ ] 模式切换按钮工作

- [ ] **代理页面**
  - [ ] 显示所有代理组
  - [ ] 切换代理组标签
  - [ ] 选择代理节点
  - [ ] 测速单个节点
  - [ ] 测速全部节点
  - [ ] 模式切换保持状态

- [ ] **配置页面**
  - [ ] 添加远程订阅
  - [ ] 显示订阅信息（流量、节点数、更新时间）
  - [ ] 更新订阅
  - [ ] 选择当前配置
  - [ ] 删除订阅
  - [ ] 重新导入已删除的订阅

- [ ] **日志页面**
  - [ ] 无配置时显示提示
  - [ ] 有配置时显示日志
  - [ ] 筛选日志级别
  - [ ] 清空日志
  - [ ] 自动滚动开关

- [ ] **设置页面**
  - [ ] TUN模式开关
  - [ ] 系统代理开关
  - [ ] 日志级别选择
  - [ ] 端口设置
  - [ ] 主题切换
  - [ ] 关于信息

---

## 构建信息

- **构建时间**：2024-11-02
- **版本**：Debug
- **架构**：arm64-v8a
- **最小SDK**：24 (Android 7.0)
- **目标SDK**：34 (Android 14)

---

## 问题反馈

如发现任何问题，请记录：
1. 复现步骤
2. 预期行为
3. 实际行为
4. 设备信息
5. 日志输出（如有）

可以通过以下方式查看应用日志：
```bash
adb logcat | grep -i "clash"
```

