# Clash Verge Rev Android - å®Œæ•´ä½¿ç”¨å’Œæµ‹è¯•æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…åº”ç”¨
```powershell
cd C:\Users\Administrator\Desktop\clash-verge-rev\mobile
.\gradlew.bat assembleDebug installDebug
```

### 2. é¦–æ¬¡ä½¿ç”¨æ­¥éª¤

#### æ­¥éª¤1ï¼šå¯¼å…¥è®¢é˜…
1. æ‰“å¼€åº”ç”¨
2. ç‚¹å‡»åº•éƒ¨å¯¼èˆª "é…ç½®"
3. ç‚¹å‡» "+ æ–°å»ºé…ç½®"
4. é€‰æ‹© "å¯¼å…¥è®¢é˜…"
5. è¾“å…¥è®¢é˜…URLï¼š`https://47.238.198.94/iv/verify_mode.htm?token=5deb6dce926526eda7974a73ffe38b4e`
6. ç‚¹å‡» "æ·»åŠ "

#### æ­¥éª¤2ï¼šå¯åŠ¨VPNæœåŠ¡
1. è¿”å› "é¦–é¡µ"
2. æ‰¾åˆ° "TUNæ¨¡å¼" å¼€å…³
3. ç‚¹å‡»å¼€å…³å¯åŠ¨VPN
4. âš ï¸ **Androidä¼šå¼¹å‡ºVPNæƒé™è¯·æ±‚** - ç‚¹å‡»"ç¡®å®š"
5. ç­‰å¾…çŠ¶æ€å˜ä¸º "è™šæ‹Ÿç½‘å¡å·²å¯ç”¨"

#### æ­¥éª¤3ï¼šåˆ‡æ¢ä»£ç†æ¨¡å¼
åœ¨é¦–é¡µï¼Œç‚¹å‡»æ¨¡å¼æŒ‰é’®åˆ‡æ¢ï¼š
- **Rule** - è§„åˆ™æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
- **Global** - å…¨å±€ä»£ç†
- **Direct** - ç›´è¿æ¨¡å¼

#### æ­¥éª¤4ï¼šé€‰æ‹©ä»£ç†èŠ‚ç‚¹
1. ç‚¹å‡»åº•éƒ¨å¯¼èˆª "ä»£ç†"
2. å±•å¼€ä»£ç†ç»„ï¼ˆå¦‚ "è‡ªåŠ¨é€‰æ‹©"ï¼‰
3. ç‚¹å‡»ä»»æ„èŠ‚ç‚¹åˆ‡æ¢

## ğŸ“‹ åŠŸèƒ½è‡ªæ£€æ¸…å•

### âœ… åŸºç¡€åŠŸèƒ½

| åŠŸèƒ½ | æ£€æŸ¥æ–¹æ³• | é¢„æœŸç»“æœ |
|-----|---------|---------|
| åº”ç”¨å¯åŠ¨ | æ‰“å¼€åº”ç”¨ | æ˜¾ç¤ºé¦–é¡µ |
| é…ç½®å¯¼å…¥ | é…ç½®é¡µé¢å¯¼å…¥è®¢é˜… | æ˜¾ç¤ºé…ç½®åˆ—è¡¨ |
| é…ç½®æ›´æ–° | ç‚¹å‡»é…ç½®çš„åˆ·æ–°æŒ‰é’® | æ›´æ–°æˆåŠŸæç¤º |
| VPNå¯åŠ¨ | é¦–é¡µç‚¹å‡»TUNå¼€å…³ | æ˜¾ç¤º"å·²å¯ç”¨" |
| æ¨¡å¼åˆ‡æ¢ | ç‚¹å‡»Rule/Global/DirectæŒ‰é’® | æŒ‰é’®çŠ¶æ€æ”¹å˜ |
| èŠ‚ç‚¹åˆ‡æ¢ | ä»£ç†é¡µé¢ç‚¹å‡»èŠ‚ç‚¹ | èŠ‚ç‚¹è¢«é€‰ä¸­ |
| å»¶è¿Ÿæµ‹è¯• | ä»£ç†é¡µé¢ç‚¹å‡»æµ‹é€Ÿå›¾æ ‡ | æ˜¾ç¤ºå»¶è¿Ÿæ•°å€¼ |
| æµé‡ç»Ÿè®¡ | é¦–é¡µæŸ¥çœ‹æµé‡å¡ç‰‡ | æ˜¾ç¤ºä¸Šä¼ /ä¸‹è½½é€Ÿåº¦ |

### âš™ï¸ é«˜çº§åŠŸèƒ½

| åŠŸèƒ½ | ä½ç½® | è¯´æ˜ |
|-----|-----|------|
| è¿æ¥ç®¡ç† | è¿æ¥é¡µé¢ | æŸ¥çœ‹å®æ—¶è¿æ¥ |
| è§„åˆ™æŸ¥çœ‹ | è§„åˆ™é¡µé¢ | æŸ¥çœ‹è·¯ç”±è§„åˆ™ |
| æ—¥å¿—æŸ¥çœ‹ | æ—¥å¿—é¡µé¢ | æŸ¥çœ‹è¿è¡Œæ—¥å¿— |
| TUNé…ç½® | è®¾ç½®é¡µé¢ | TUNæ¨¡å¼è¯¦ç»†è®¾ç½® |
| Mergeé…ç½® | é…ç½®é¡µé¢ | å…¨å±€é…ç½®è¦†ç›– |
| Scripté…ç½® | é…ç½®é¡µé¢ | JavaScripté…ç½®å¤„ç† |

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šVPNå¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼šç‚¹å‡»TUNå¼€å…³åæ— ååº”æˆ–æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ—¥å¿—ï¼š
```powershell
adb logcat -d | Select-String "ClashVpnService|VPN" | Select-Object -Last 50
```

2. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼š
- "Config file not found" â†’ å…ˆå¯¼å…¥è®¢é˜…
- "Permission denied" â†’ é‡æ–°æˆäºˆVPNæƒé™
- "Native library error" â†’ é‡æ–°å®‰è£…åº”ç”¨

3. é‡å¯åº”ç”¨ï¼š
```powershell
adb shell am force-stop io.github.clash_verge_rev.clash_verge_rev.debug
adb shell am start -n io.github.clash_verge_rev.clash_verge_rev.debug/io.github.clash_verge_rev.clash_verge_rev.MainActivity
```

### é—®é¢˜2ï¼šèŠ‚ç‚¹åˆ‡æ¢å¤±è´¥

**ç—‡çŠ¶**ï¼šç‚¹å‡»èŠ‚ç‚¹æ— ååº”æˆ–æç¤ºå¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. HTTP APIæœåŠ¡å™¨æœªå¯åŠ¨ï¼ˆVPNæœªå¯åŠ¨ï¼‰
2. é…ç½®æ–‡ä»¶æœªæ­£ç¡®åŠ è½½
3. ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿VPNå·²å¯åŠ¨
2. æ£€æŸ¥APIæœåŠ¡å™¨æ—¥å¿—ï¼š
```powershell
adb logcat -d | Select-String "ProxyApiServer|API Request" | Select-Object -Last 30
```

3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼š
```powershell
adb logcat -d | Select-String "ProxyRepository.*switch" | Select-Object -Last 20
```

### é—®é¢˜3ï¼šæ¨¡å¼åˆ‡æ¢æ— æ•ˆ

**ç—‡çŠ¶**ï¼šç‚¹å‡»æ¨¡å¼æŒ‰é’®åæ¨¡å¼æœªæ”¹å˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥APIè°ƒç”¨ï¼š
```powershell
adb logcat -d | Select-String "switchMode|PATCH.*configs" | Select-Object -Last 10
```

2. æŸ¥çœ‹é…ç½®æ–‡ä»¶æ˜¯å¦æ›´æ–°ï¼š
```powershell
adb shell "run-as io.github.clash_verge_rev.clash_verge_rev.debug cat /data/user/0/io.github.clash_verge_rev.clash_verge_rev.debug/files/configs/*.yaml | grep mode"
```

## ğŸ§ª å®Œæ•´åŠŸèƒ½æµ‹è¯•è„šæœ¬

### è‡ªåŠ¨åŒ–æµ‹è¯•
```powershell
cd C:\Users\Administrator\Desktop\clash-verge-rev\mobile
powershell -ExecutionPolicy Bypass -File .\scripts\test-all-functions.ps1
```

### æ‰‹åŠ¨æµ‹è¯•æµç¨‹

#### æµ‹è¯•1ï¼šVPNæœåŠ¡
```powershell
# 1. å¯åŠ¨VPN
# åœ¨åº”ç”¨ä¸­ç‚¹å‡»TUNå¼€å…³

# 2. ç­‰å¾…3ç§’ï¼Œæ£€æŸ¥æ—¥å¿—
adb logcat -d | Select-String "ClashVpnService.*Started|API Server started" | Select-Object -Last 5
```

é¢„æœŸè¾“å‡ºï¼š
```
ClashVpnService: Starting VPN service...
ClashVpnService: âœ… VPN started successfully
ProxyApiServer: âœ… API Server started on port 9090
```

#### æµ‹è¯•2ï¼šèŠ‚ç‚¹åˆ‡æ¢
```powershell
# 1. åœ¨ä»£ç†é¡µé¢é€‰æ‹©èŠ‚ç‚¹
# 2. æŸ¥çœ‹æ—¥å¿—
adb logcat -d | Select-String "switchProxy|API Request.*proxies" | Select-Object -Last 10
```

é¢„æœŸè¾“å‡ºï¼š
```
ProxyRepository: âš™ï¸ Switching proxy: èŠ‚ç‚¹åç§°
ProxyApiServer: API Request: PUT /proxies/è‡ªåŠ¨é€‰æ‹©
ProxyRepository: âœ… Proxy switched successfully
```

#### æµ‹è¯•3ï¼šæ¨¡å¼åˆ‡æ¢
```powershell
# 1. åœ¨é¦–é¡µåˆ‡æ¢æ¨¡å¼
# 2. æŸ¥çœ‹æ—¥å¿—
adb logcat -d | Select-String "switchMode|Mode.*switched" | Select-Object -Last 10
```

é¢„æœŸè¾“å‡ºï¼š
```
ProxyRepository: âš™ï¸ Switching mode to: global
ProxyApiServer: API Request: PATCH /configs
ProxyApiServer: Mode updated to global
ProxyRepository: âœ… Mode switched successfully
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```powershell
adb logcat -s ProxyApiServer:I ProxyRepository:I ClashVpnService:I
```

### æŸ¥çœ‹æµé‡ç»Ÿè®¡
```powershell
adb logcat -d | Select-String "Traffic|upload|download" | Select-Object -Last 20
```

### æŸ¥çœ‹è¿æ¥ä¿¡æ¯
```powershell
adb logcat -d | Select-String "Connection|connect" | Select-Object -Last 30
```

## ğŸ¯ å·²çŸ¥é™åˆ¶

### Androidå¹³å°ç‰¹æ€§
1. **ä¸éœ€è¦ç³»ç»Ÿä»£ç†** - Androidä½¿ç”¨TUNæ¨¡å¼ï¼Œæ— éœ€è®¾ç½®ç³»ç»Ÿä»£ç†
2. **VPNæƒé™å¿…éœ€** - é¦–æ¬¡å¯åŠ¨éœ€æˆäºˆVPNæƒé™
3. **åå°é™åˆ¶** - æŸäº›æ‰‹æœºå¯èƒ½é™åˆ¶åå°è¿è¡Œ

### å½“å‰å®ç°çŠ¶æ€

#### âœ… å·²å®ç°
- TUNæ¨¡å¼VPNæœåŠ¡
- HTTP APIæœåŠ¡å™¨ï¼ˆKotlinå®ç°ï¼‰
- ä»£ç†èŠ‚ç‚¹åˆ‡æ¢
- ä»£ç†æ¨¡å¼åˆ‡æ¢ï¼ˆRule/Global/Directï¼‰
- æµé‡ç»Ÿè®¡
- å»¶è¿Ÿæµ‹è¯•
- è®¢é˜…ç®¡ç†
- é…ç½®ç¼–è¾‘
- è§„åˆ™æŸ¥çœ‹
- è¿æ¥æŸ¥çœ‹
- æ—¥å¿—æŸ¥çœ‹

#### âŒ æœªå®ç°ï¼ˆå¯é€‰ï¼‰
- ä»£ç†é“¾æ¨¡å¼
- æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
- è¿æ¥å…³é—­åŠŸèƒ½
- DNSé…ç½®UI
- è¯­è¨€åˆ‡æ¢

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è®¢é˜…ç®¡ç†
- å®šæœŸæ›´æ–°è®¢é˜…ï¼ˆ24å°æ—¶ï¼‰
- ä¿ç•™å¤‡ç”¨é…ç½®
- ä½¿ç”¨Mergeé…ç½®è‡ªå®šä¹‰è§„åˆ™

### 2. èŠ‚ç‚¹é€‰æ‹©
- ä½¿ç”¨å»¶è¿Ÿæµ‹è¯•é€‰æ‹©æœ€å¿«èŠ‚ç‚¹
- è§„åˆ™æ¨¡å¼ä¸‹è‡ªåŠ¨é€‰æ‹©
- å…¨å±€æ¨¡å¼ç”¨äºç‰¹å®šéœ€æ±‚

### 3. æ€§èƒ½ä¼˜åŒ–
- åŠæ—¶æ¸…ç†è¿æ¥
- å®šæœŸæŸ¥çœ‹æ—¥å¿—æ’æŸ¥é—®é¢˜
- é¿å…é¢‘ç¹åˆ‡æ¢èŠ‚ç‚¹

## ğŸ†˜ è·å–å¸®åŠ©

### æ—¥å¿—æ”¶é›†
```powershell
# å®Œæ•´æ—¥å¿—
adb logcat -d > clash_verge_full.log

# æ ¸å¿ƒæ—¥å¿—
adb logcat -d | Select-String "clash_verge|Mihomo|Proxy|VPN" > clash_verge_core.log
```

### é‡ç½®åº”ç”¨
```powershell
# æ¸…é™¤æ•°æ®
adb shell pm clear io.github.clash_verge_rev.clash_verge_rev.debug

# é‡æ–°å®‰è£…
cd C:\Users\Administrator\Desktop\clash-verge-rev\mobile
.\gradlew.bat assembleDebug installDebug
```


